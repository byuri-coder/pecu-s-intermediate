
{
  "entities": {
    "User": {
      "title": "User",
      "description": "Represents a user's account and profile information.",
      "type": "object",
      "properties": {
        "name": { "type": "string", "description": "The user's full name." },
        "email": { "type": "string", "format": "email", "description": "The user's email address." },
        "role": { "type": "string", "enum": ["seller", "buyer", "admin"], "description": "The user's role in the platform." },
        "verified": { "type": "boolean", "description": "Indicates if the user's email is verified." },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["name", "email", "role", "createdAt"]
    },
    "Listing": {
      "title": "Listing",
      "description": "Represents a generic marketplace listing.",
      "type": "object",
      "properties": {
        "sellerId": { "type": "string", "description": "The ID of the user who created the listing." },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "price": { "type": "number" },
        "category": { "type": "string", "enum": ["carbon-credit", "tax-credit", "rural-land"] },
        "images": { "type": "array", "items": { "type": "string", "format": "uri" } },
        "status": { "type": "string", "enum": ["active", "pending", "sold", "paused"] },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["sellerId", "title", "price", "category", "status", "createdAt"]
    },
    "Transaction": {
      "title": "Transaction",
      "description": "Records a completed transaction between a buyer and a seller.",
      "type": "object",
      "properties": {
        "buyerId": { "type": "string" },
        "sellerId": { "type": "string" },
        "listingId": { "type": "string" },
        "value": { "type": "number" },
        "type": { "type": "string", "enum": ["venda", "arrendamento", "permuta"] },
        "status": { "type": "string", "enum": ["completed", "pending", "cancelled"] },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["buyerId", "sellerId", "listingId", "value", "type", "status", "createdAt"]
    },
    "Negotiation": {
      "title": "Negotiation",
      "description": "Represents the state of a negotiation for an asset, including the chat status.",
      "type": "object",
      "properties": {
        "assetId": { "type": "string" },
        "buyerId": { "type": "string" },
        "sellerId": { "type": "string" },
        "chatId": { "type": "string" },
        "status": { 
          "type": "string", 
          "enum": ["aguardando_resposta", "em_andamento", "encerrado", "arquivado"],
          "description": "aguardando_resposta: Chat criado, vendedor ainda não respondeu. em_andamento: Ambos podem enviar mensagens. encerrado: Negociação finalizada, chat somente leitura. arquivado: Chat fora da lista ativa, pode ser reaberto."
        },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      }
    },
    "Message": {
      "title": "Message",
      "description": "Represents a single message within a negotiation chat.",
      "type": "object",
      "properties": {
          "messageId": { "type": "string" },
          "chatId": { "type": "string" },
          "senderId": { "type": "string" },
          "receiverId": { "type": "string" },
          "content": { "type": "string", "description": "Contains text or a URL to a file." },
          "type": { "type": "string", "enum": ["text", "image", "document", "voice"] },
          "timestamp": { "type": "string", "format": "date-time" },
          "status": { "type": "string", "enum": ["sent", "delivered", "read"] }
      }
    },
    "Contract": {
        "title": "Contract",
        "description": "Stores the adjustable contract details for a negotiation.",
        "type": "object",
        "properties": {
            "negotiationId": { "type": "string" },
            "templateId": { "type": "string" },
            "placeholders": { "type": "object" },
            "fields": {
                "type": "object",
                "properties": {
                    "seller": { "type": "object" },
                    "buyer": { "type": "object" }
                }
            },
            "previewHtml": { "type": "string" },
            "isFrozen": { "type": "boolean" },
            "frozenAt": { "type": "string", "format": "date-time" },
            "finalizedAt": { "type": "string", "format": "date-time" },
            "generatedPdfUrl": { "type": "string", "format": "uri" },
            "uploads": {
                "type": "object",
                "properties": {
                    "seller": { "type": "array", "items": { "type": "object" } },
                    "buyer": { "type": "array", "items": { "type": "object" } }
                }
            }
        }
    },
    "VerificationToken": {
        "title": "Verification Token",
        "description": "Stores a one-time token for email verification.",
        "type": "object",
        "properties": {
            "negotiationId": { "type": "string" },
            "role": { "type": "string", "enum": ["seller", "buyer"] },
            "email": { "type": "string", "format": "email" },
            "tokenHash": { "type": "string" },
            "expiresAt": { "type": "string", "format": "date-time" },
            "createdAt": { "type": "string", "format": "date-time" },
            "usedAt": { "type": "string", "format": "date-time" }
        }
    },
    "AuditLog": {
        "title": "Audit Log",
        "description": "Logs critical events for a negotiation.",
        "type": "object",
        "properties": {
            "negotiationId": { "type": "string" },
            "event": { "type": "string", "enum": ["email_verification", "upload", "finalization", "duplicate_generated"] },
            "byUserId": { "type": "string" },
            "meta": { "type": "object" },
            "createdAt": { "type": "string", "format": "date-time" }
        }
    },
    "Duplicate": {
        "title": "Duplicate",
        "description": "Represents an invoice or installment for a transaction.",
        "type": "object",
        "properties": {
            "negotiationId": { "type": "string" },
            "invoiceNumber": { "type": "string" },
            "orderNumber": { "type": "string" },
            "issueDate": { "type": "string", "format": "date-time" },
            "dueDate": { "type": "string" },
            "value": { "type": "number" },
            "qr": { "type": "object" },
            "pdfUrl": { "type": "string", "format": "uri" },
            "createdAt": { "type": "string", "format": "date-time" }
        }
    }
  },
  "auth": {
    "providers": ["email"]
  },
  "firestore": {
    "/users/{userId}": {
      "schema": { "$ref": "#/entities/User" },
      "description": "Stores user account and profile information."
    },
    "/listings/{listingId}": {
      "schema": { "$ref": "#/entities/Listing" },
      "description": "Stores all marketplace listings (carbon, tax, land)."
    },
    "/transactions/{transactionId}": {
      "schema": { "$ref": "#/entities/Transaction" },
      "description": "Stores all completed transactions."
    },
    "/negociacoes/{negotiationId}": {
      "schema": { "$ref": "#/entities/Negotiation" },
      "description": "Stores the state of a negotiation for an asset."
    },
    "/negociacoes/{negotiationId}/messages/{messageId}": {
        "schema": {
          "$ref": "#/entities/Message"
        },
        "description": "Stores messages for a specific negotiation chat."
    },
    "/contracts/{contractId}": {
        "schema": { "$ref": "#/entities/Contract" },
        "description": "Stores the adjustable contract details for a negotiation."
    },
    "/verification_tokens/{tokenId}": {
        "schema": { "$ref": "#/entities/VerificationToken" },
        "description": "Stores one-time tokens for email verification."
    },
    "/audit_logs/{logId}": {
        "schema": { "$ref": "#/entities/AuditLog" },
        "description": "Logs critical events for auditing purposes."
    },
    "/duplicates/{duplicateId}": {
        "schema": { "$ref": "#/entities/Duplicate" },
        "description": "Stores generated invoices/duplicates for a transaction."
    }
  },
  "recommendedTechnicalStack": {
      "database": "MongoDB (collections: Users, Negotiations, Chats, Messages)",
      "realtime": "Socket.IO (Node) or Firebase Realtime Database",
      "fileStorage": "Firebase Storage or AWS S3",
      "backend": "Next.js API Routes + Express (for WebSocket server)",
      "frontend": "Next.js + Zustand (store) + Shadcn UI + Tailwind",
      "security": "JWT + AES-256 encryption for messages",
      "notifications": "Firebase Cloud Messaging (Push Notifications)"
  }
}
